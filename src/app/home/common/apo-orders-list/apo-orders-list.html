<div class="main-layout">
  <!-- Table Container -->
  <div class="table-container">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      matSortActive="orderNo"
      matSortDisableClear
      matSortDirection="desc"
    >
      <!-- Table Columns (no changes) -->
      <ng-container matColumnDef="#">
        <th mat-header-cell *matHeaderCellDef class="text-align-center">#</th>
        <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
      </ng-container>
      <ng-container matColumnDef="orderNo">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          Request ID
        </th>
        <td mat-cell *matCellDef="let row">{{ row?.orderNo }}</td>
      </ng-container>
      <ng-container matColumnDef="empName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let row">{{ row?.person?.empName }}</td>
      </ng-container>
      <ng-container matColumnDef="service">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Service</th>
        <td mat-cell *matCellDef="let row">{{ row?.person?.service }}</td>
      </ng-container>
      <ng-container matColumnDef="apoDt">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          APO Date
        </th>
        <td mat-cell *matCellDef="let row">{{ row?.apoDt }}</td>
      </ng-container>
      <ng-container matColumnDef="posOrderDt">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          Posting Date
        </th>
        <td mat-cell *matCellDef="let row">{{ row?.posOrderDt }}</td>
      </ng-container>
      <ng-container matColumnDef="joiningDt">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          Joining Date
        </th>
        <td mat-cell *matCellDef="let row">{{ row?.joiningDt }}</td>
      </ng-container>
      <ng-container matColumnDef="apoDurtn">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          APO Duration
        </th>
        <td mat-cell *matCellDef="let row" class="text-align-center">
          {{ row?.apoDurtn }}
        </td>
      </ng-container>
      <ng-container matColumnDef="aging">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          Aging
        </th>
        <td mat-cell *matCellDef="let row" class="text-align-center">
          {{ row?.aging }}
        </td>
      </ng-container>
      <ng-container matColumnDef="status">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-align-center"
        >
          Status
        </th>
        <td mat-cell *matCellDef="let row" class="text-align-center">
          <button
            mat-button
            class="status-button"
            (click)="goToAPO(row?.orderNo, row?.status?.statusId)"
            [ngClass]="getStatusClass(row?.status?.statusId)"
          >
            <img
              src="\assets\images\{{
                row?.status?.statusName | lowercase
              }}-icon.png"
            />
            {{ row.status.statusName | titlecase }}
          </button>
        </td>
      </ng-container>
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef class="text-align-center">
          Action
        </th>
        <td mat-cell *matCellDef="let row" class="text-align-center">
          <button
            mat-icon-button
            (click)="goToAPO(row?.orderNo, row?.status?.statusId)"
            color="accent"
            class="circle-button"
          >
            <img
              *ngIf="
                row.status.statusId == enumStatus.DRAFT ||
                row.status.statusId == enumStatus.PENDING
              "
              src="\assets\images\edit-icon.png"
            />
            <img
              *ngIf="
                row.status.statusId != enumStatus.DRAFT &&
                row.status.statusId != enumStatus.PENDING
              "
              src="\assets\images\view-icon.png"
            />
          </button>
          <button
            *ngIf="
              (row.status.statusId == enumStatus.DRAFT &&
                this.roleId == enumRole.INITIATOR) ||
              isDelete
            "
            mat-icon-button
            (click)="deleteApoOrder(row.orderNo)"
            color="accent"
            class="circle-button"
          >
            <img src="\assets\images\delete-red-icon.png" />
          </button>
          <button
            *ngIf="
              row.status.statusId != enumStatus.DRAFT &&
              this.roleId == enumRole.INITIATOR
            "
            mat-icon-button
            color="accent"
            class="circle-button"
          >
            <img src="\assets\images\delete-white-icon.png" />
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <!-- Pagination and Filter Button (no changes) -->
  <div class="pagination-container">
    <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
      aria-label="Select page of periodic elements"
    ></mat-paginator>
  </div>
  <div class="filter-section-right">
    <button
      mat-raised-button
      (click)="openFilterDialog()"
      class="filter-button"
    >
      <mat-icon>filter_list</mat-icon> Filter
    </button>
  
    
  </div>

  <!-- Corrected Filter Dialog -->
  <div
    class="filter-dialog-overlay"
    *ngIf="showFilterDialog"
    (click)="closeFilterDialog()"
  >
    <div class="filter-dialog" (click)="$event.stopPropagation()">
      <div class="filter-header">
        <div class="filter-title">
          <mat-icon>filter_list</mat-icon>
          <h3>Filter</h3>
        </div>
        <button
          mat-icon-button
          (click)="closeFilterDialog()"
          class="close-button"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="filter-content">
        <!-- Row 1: Request ID, Name, Service -->
        <div class="filter-grid">
          <div class="filter-section">
            <label>Request ID Search</label>
            <mat-form-field appearance="outline" class="filter-input">
              <span matPrefix class="search-icon-wrapper"
                ><mat-icon>search</mat-icon></span
              >
              <input
                matInput
                [(ngModel)]="filterData.requestId"
                placeholder="Search"
              />
            </mat-form-field>
          </div>
          <div class="filter-section">
            <label>Name Search</label>
            <mat-form-field appearance="outline" class="filter-input">
              <span matPrefix class="search-icon-wrapper"
                ><mat-icon>search</mat-icon></span
              >
              <input
                matInput
                [(ngModel)]="filterData.name"
                placeholder="Search"
              />
            </mat-form-field>
          </div>
          <div class="filter-section">
            <label>Service Selector</label>
            <mat-form-field appearance="outline" class="filter-select">
              <mat-select
                [(ngModel)]="filterData.service"
                placeholder="Select Service"
              >
                <mat-option value="Devasthan Subordinate"
                  >Devasthan Subordinate</mat-option
                >
                <mat-option value="Rural Development"
                  >Rural Development</mat-option
                >
                <mat-option value="Tehsildar">Tehsildar</mat-option>
                <mat-option value="Cooperative">Cooperative</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- Row 2: APO Date, APO Duration, Aging -->
        <div class="filter-grid">
          <div class="filter-section">
            <label>APO Date Selector</label>
            <mat-form-field appearance="outline" class="date-input">
              <input
                matInput
                [matDatepicker]="apoFromPicker"
                placeholder="13-Jun-2024 - 22-Jun-2024"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="apoFromPicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #apoFromPicker></mat-datepicker>
            </mat-form-field>
          </div>
          <div class="filter-section">
            <label>Posting Date Selector</label>
            <mat-form-field appearance="outline" class="date-input">
              <input
                matInput
                [matDatepicker]="postFromPicker"
                placeholder="13-Jun-2024 - 22-Jun-2024"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="postFromPicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #postFromPicker></mat-datepicker>
            </mat-form-field>
          </div>
          <div class="filter-section">
            <label>Joining Date Selector</label>
            <mat-form-field appearance="outline" class="date-input">
              <input
                matInput
                [matDatepicker]="joinFromPicker"
                placeholder="13-Jun-2024 - 22-Jun-2024"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="joinFromPicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #joinFromPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>

        <!-- Row 3: Posting Date, Aging, Status -->
        <div class="filter-grid">
          <div class="filter-section">
            <label>APO Duration Selector</label>
            <mat-form-field appearance="outline" class="duration-select">
              <mat-select
                [(ngModel)]="filterData.apoDuration"
                placeholder="Less than 30 Days"
              >
                <mat-option value="Less than 15 Days"
                  >Less than 15 Days</mat-option
                >
                <mat-option value="Less than 30 Days"
                  >Less than 30 Days</mat-option
                >
                <mat-option value="More than 30 Days"
                  >More than 30 Days</mat-option
                >
                <mat-option value="2025">2025</mat-option>
                <mat-option value="2024">2024</mat-option>
                <mat-option value="2023">2023</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="filter-section">
            <label>Aging Selector</label>
            <mat-form-field appearance="outline" class="duration-select">
              <mat-select
                [(ngModel)]="filterData.agingDuration"
                placeholder="Less than 30 Days"
              >
                <mat-option value="Less than 15 Days"
                  >Less than 15 Days</mat-option
                >
                <mat-option value="Less than 30 Days"
                  >Less than 30 Days</mat-option
                >
                <mat-option value="More than 30 Days"
                  >More than 30 Days</mat-option
                >
                <mat-option value="2025">2025</mat-option>
                <mat-option value="2024">2024</mat-option>
                <mat-option value="2023">2023</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="filter-section">
            <label>Status Selector</label>
            <mat-form-field appearance="outline" class="status-select">
              <mat-select
                [(ngModel)]="filterData.status"
                placeholder="Returned"
              >
                <mat-option value="Draft">Draft</mat-option>
                <mat-option value="Pending">Pending</mat-option>
                <mat-option value="Returned">Returned</mat-option>
                <mat-option value="Submitted">Submitted</mat-option>
                <mat-option value="Rejected">Rejected</mat-option>
                <mat-option value="Approved">Approved</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="filter-actions">
          <button
            mat-raised-button
            (click)="clearAllFilters()"
            class="clear-all-btn"
          >
            Clear All
          </button>
          <button
            mat-raised-button
            (click)="applyAllFilters()"
            class="apply-btn"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
